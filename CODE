{
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "f0b63cb9-7976-48f4-9ca4-dbdf48541cbe",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -544,
        96
      ],
      "webhookId": "1e6df9a4-7297-4d8c-85b8-0e8ab58d5911"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e5e34ef6-384c-4b0c-9fc5-46465f6ed874",
              "leftValue": "={{ $json.message.voice.file_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e0f80697-abbc-4373-a56c-398d5af909d0",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -288,
        96
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "id": "018d801e-2594-4d9d-9d1d-76b75fc7c812",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        32,
        16
      ],
      "webhookId": "35752d03-59ac-4bd6-b8f0-4fe8cf76d112"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "63ffa149-d8fd-458e-8e53-12dd56bed2f9",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -112,
        448
      ]
    },
    {
      "parameters": {
        "name": "outbound_phone_call",
        "description": "Call this tool to make a phone call to somebody.",
        "workflowId": {
          "__rl": true,
          "value": "XTHKUOPOPHdfMzoF",
          "mode": "list",
          "cachedResultName": "üî®phone_call"
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"first_name\": {\n      \"type\": \"string\",\n      \"description\": \"The first name of the customer\"\n    },\n    \"type\": {\n      \"type\": \"string\",\n      \"description\": \"Type of relationship (e.g., friend)\"\n    },\n    \"instructions\": {\n      \"type\": \"string\",\n      \"description\": \"Instructions for the agent\"\n    },\n    \"phone_number\": {\n      \"type\": \"string\",\n      \"description\": \"The customer's phone number in E.164 format\"\n    }\n  },\n  \"required\": [\"first_name\", \"phone_number\"]\n}\n"
      },
      "id": "f5070afa-bb6d-4573-b356-ab5dd5c3e39a",
      "name": "phonecall_someone",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        480,
        496
      ]
    },
    {
      "parameters": {
        "name": "data",
        "description": "Returns information related to the company reprise",
        "topK": 1
      },
      "id": "d8bb1827-6a60-4d81-b016-ae79eed3c39a",
      "name": "Vector Store Tool",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        -16,
        608
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e554d73a-e7b4-4f9c-b6e5-66603d4e948e",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.1,
      "position": [
        -208,
        1008
      ]
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "b61e3a25-c004-4769-8e60-fda6c9769ce3",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        96,
        816
      ]
    },
    {
      "parameters": {
        "pineconeIndex": {
          "__rl": true,
          "value": "reprisecrm",
          "mode": "list",
          "cachedResultName": "reprisecrm"
        },
        "options": {
          "pineconeNamespace": "reprise"
        }
      },
      "id": "a78c1bd3-7bfb-465a-8dbc-d93937dde2fb",
      "name": "Pinecone Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1,
      "position": [
        -208,
        784
      ]
    },
    {
      "parameters": {
        "from": "+1 844 910 2125",
        "to": "+1 216 570 3136",
        "message": "={{ $json.output }}",
        "options": {}
      },
      "id": "fa6ed339-e62c-4423-8603-f3146d5dc790",
      "name": "Twilio",
      "type": "n8n-nodes-base.twilio",
      "typeVersion": 1,
      "position": [
        432,
        288
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "91e844be-1399-4a9b-94a1-64b3937995c7",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        256,
        16
      ]
    },
    {
      "parameters": {
        "sendTo": "={{ $fromAI(\"emailAddress\") }}",
        "subject": "={{ $fromAI(\"subject\") }}",
        "message": "={{ $fromAI(\"message\") }}",
        "options": {}
      },
      "id": "02ac3c63-f77f-4952-8e48-e63fcf901a61",
      "name": "Gmail",
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        320,
        512
      ],
      "webhookId": "12e9d973-710b-43d0-a038-1d0eeb1c6634"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text || $json.message.text }}",
        "options": {
          "systemMessage": "Interpret the message to identify instructions, such as making a call, sending an email, or reaching out to someone.\nLook for phrases like \"call [name]\", \"email [name]\", or similar instructions.\nDynamically extract the name and any additional details (e.g., subject, content) from the message.\nSearch Pinecone Vector Database:\n\nUse the extracted name to query the Pinecone vector database for relevant information.\nIf the task involves sending an email and the email address is not provided, search Pinecone to retrieve the associated email address.\nIf a match is found, retrieve the required information (e.g., phone number for calls, email for messages). If no match is found, respond with \"No contact found for [Extracted Name]\" and halt further actions.\nDetermine Action:\n\nTrigger Outbound Call:\n\nIf the instruction involves making a call, pass the retrieved phone number to the phonecall_someone module to initiate the outbound call.\nConfirm the action (e.g., ‚ÄúCalling [Extracted Name] now‚Äù) and send any necessary follow-up information or status updates.\nSend Email via Gmail Module:\n\nIf the instruction involves sending an email, use the Gmail module to compose and send the message.\nInclude the relevant subject, content, and recipient email address.\nConfirm the action (e.g., ‚ÄúEmailing [Extracted Name] now‚Äù) and send any necessary follow-up information or status updates.\nProvide Feedback:\n\nConfirm the chosen action (calling or emailing) and notify the user about the progress (e.g., ‚ÄúEmail sent to [Extracted Name]‚Äù or ‚ÄúCalling [Extracted Name] now‚Äù).",
          "returnIntermediateSteps": true
        }
      },
      "id": "c282b68d-261f-478b-9621-b87d0e53378c",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        64,
        288
      ]
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "phonecall_someone": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Twilio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "6283093bfc862913322ac84787f3533392f92d3ea6e4cea7901e98c96a00dda9"
  }
}
{
  "nodes": [
    {
      "parameters": {},
      "id": "749d51f8-10c9-46b2-8a43-dac4215cc6f6",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -880,
        240
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.vapi.ai/call/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer a5b9d8e2-dc28-4402-b79e-f29b738014d0"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"assistantId\": \"ec6cbe35-6993-4a7c-a87d-8b1f30e30816\",\n  \"assistantOverrides\": {\n    \"variableValues\": {\n      \"first_name\": \"{{ $json.query.first_name }}\",\n      \"type\": \"{{ $json.query.type }}\",\n      \"instructions\": \"{{ $json.query.instructions }}\",\n      \"phone_number\": \"+{{ $json.query.phone_number }}\"\n    }\n  },\n  \"customer\": {\n    \"number\": \"+{{ $json.query.phone_number }}\",\n    \"name\": \"{{ $json.query.first_name }}\"\n  },\n  \"phoneNumberId\": \"52118b94-afda-468d-be47-c0d71e320b51\"\n}\n",
        "options": {}
      },
      "id": "9f56cb74-66cb-4569-8b11-0b2fffd742e7",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -448,
        240
      ]
    },
    {
      "parameters": {
        "url": "=https://api.vapi.ai/call/{{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer a5b9d8e2-dc28-4402-b79e-f29b738014d0"
            }
          ]
        },
        "options": {}
      },
      "id": "a9a7bc93-392e-4166-a002-1f0155e6e4ff",
      "name": "HTTP Request1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -224,
        240
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "5abd5074-b463-4c9d-9437-1faf8d8b548a",
              "leftValue": "={{ $json.status }}",
              "rightValue": "=ended",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8f3dd894-5362-484f-9675-815e73a015b0",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.1,
      "position": [
        48,
        288
      ]
    },
    {
      "parameters": {
        "amount": 3
      },
      "id": "9400bede-d748-4028-b189-e386358dc20a",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        32,
        0
      ],
      "webhookId": "0f01c3d2-5a92-4718-bb7b-d8502aa8c7b2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "24ffca6f-dddd-4db4-be5e-0c3029f667fc",
              "name": "response",
              "value": "={{ $json.analysis.summary }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "dcbc4dae-8eb2-4637-a3e3-6ccaa3b8d28d",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        288,
        272
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cf5202ad-3956-49e5-94bf-9b924619b84c",
              "leftValue": "={{ $json.query.phone_number }}",
              "rightValue": "=+",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "072f2bba-6313-4a49-9186-e1d88462cbae",
      "name": "If1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -656,
        240
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.vapi.ai/call/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer a5b9d8e2-dc28-4402-b79e-f29b738014d0"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"assistantId\": \"ec6cbe35-6993-4a7c-a87d-8b1f30e30816\",\n  \"assistantOverrides\": {\n    \"variableValues\": {\n      \"first_name\": \"{{ $json.query.first_name }}\",\n      \"type\": \"{{ $json.query.type }}\",\n      \"instructions\": \"{{ $json.query.instructions }}\",\n      \"phone_number\": \"{{ $json.query.phone_number }}\"\n    }\n  },\n  \"customer\": {\n    \"number\": \"{{ $json.query.phone_number }}\",\n    \"name\": \"{{ $json.query.first_name }}\"\n  },\n  \"phoneNumberId\": \"52118b94-afda-468d-be47-c0d71e320b51\"\n}\n",
        "options": {}
      },
      "id": "cdefc1bf-5c05-45dc-a52f-4d5d9b4d5211",
      "name": "HTTP Request2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -464,
        432
      ]
    }
  ],
  "connections": {
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {
    "Execute Workflow Trigger": [
      {
        "type": "object",
        "properties": {
          "first_name": {
            "type": "string",
            "description": "The first name of the customer"
          },
          "type": {
            "type": "string",
            "description": "Type of relationship (e.g., friend)"
          },
          "instructions": {
            "type": "string",
            "description": "Instructions for the agent"
          },
          "phone_number": {
            "type": "string",
            "description": "The customer's phone number in E.164 format"
          }
        },
        "required": [
          "first_name",
          "phone_number"
        ]
      }
    ]
  },
  "meta": {
    "instanceId": "6283093bfc862913322ac84787f3533392f92d3ea6e4cea7901e98c96a00dda9"
  }
}
